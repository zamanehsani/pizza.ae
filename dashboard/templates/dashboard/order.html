{% extends 'dashboard/base.html' %}
{% load static %}

{% block css %}

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<style>
  
  p {
    color:#F96302;
  }

</style>

<script src="https://code.iconify.design/2/2.0.4/iconify.min.js"></script>
{% endblock css %}

{% block content %}
      <!-- Content Header (Page header) -->
      <div class="content-header">
          <div class="container">
            <div class="row mb-2">
              <div class="col-sm-6">
                <h1 class="m-0"> Dashboard <small> Order</small></h1>
              </div><!-- /.col -->
              <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                  <li class="breadcrumb-item"><a href="{% url 'dashboard:dashboard' %}">Home</a></li>
                  <li class="breadcrumb-item active"> Order</li>
                </ol>
              </div><!-- /.col -->
            </div><!-- /.row -->
          </div><!-- /.container-fluid -->
      </div>
      <!-- /.content-header -->
  
      <!-- Main content -->
      <div class="content" style="padding-bottom: 10px;">
        <div class="container">
          
          <!-- Small boxes (Stat box) -->
          <div class="card card-orange card-outline">
         
            <div class="card-header">
              <h3 class="card-title d-none d-lg-inline" onclick="text(2)" > <i class="fas fa-edit"></i>  Orders</h3>
              {% if perms.dashboard.add_order %}
              <a href="{% url 'dashboard:dashboard'%}" class="btn bg-orange float-right pt-0 pb-0 mr-2"> Add order</a>
              {% endif %}
            </div>
           
            <div class="card-body" style="background-color: antiquewhite;" id="card-body">
              {% for order in object_list %}
                {% if order.status != 'ordered' %}
              <div class="card new_order_card">
                <!-- play a sound on new order controls is removed to hide -->
                <audio  autoplay>
                  <source src="{% static 'sound/notification_sound.wav' %}" type="audio/wav">
                  not supporting audio element.
                </audio>
                <div class="card-body">
                  <div class="row">
                    <div class="col-sm-12 col-md-4 order">
                      <p class="">ID:<span class="fw-bold" id="order_id">{{order.id}}</span> </p>
                      <hr>
                      <p class="">NAME: <span class="fw-bold" id="order_name">{{order.nl;lame}}</span> </p>
                      <hr>
                      <p class="">NUMBER: <span class="order_number fw-bold">{{order.name}}</span> </p>
                      <hr>
                      <p class="">NOTE:<span class="order_note fw-bold">{{order.description}}</span> </p>
                    </div>
                    <div class="col-sm-12 col-md-4 border-right border-left border-light  my-4">
                      {% for item in order.order_item_list.all %}
                      <p class="fs-5 my-0">{{item.quantity}}
                        <span class="iconify" data-icon="clarity:times-line" style="color: #f96302;" data-width="25" data-height="25"></span>
                        {{item.menu_item.name}} <span class="float-right">{{item.menu_item.price}} AED</span>
                      </p>
                      {% endfor %}
                      <hr>
                      <p class="fs-5">TOTAL BIll 
                        <span class="small text-success ">{{order.payment_method}}</span> 
                        <span class="float-right">{{order.get_totol}} AED </span></p>
                      <hr>
                      <div class="text-center">
                        <button class="btn btn-success px-5 mx-3 btn-accept"  data-id="{{order.id}}"  type="button">Accept</button>
                        <button class="btn btn-outline-danger px-5 mx-2 btn-reject" data-id="{{order.id}}" type="button">Reject</button>
                      </div>
                    </div>
                    <div class="col-sm-12 col-md-4 my-auto">
                      <div class="card" style="box-shadow: none; border-radius: 7px;">
                        <div class="card-header" style="background-color: transparent;">
                          <p class="mb-0 fs-5 fw-bold">ADDRESS</p>
                        </div>
                        <div class="card-body text-center">
                          <p class="address">{{order.address}}</p>
                          <span class="iconify" data-icon="fluent:document-copy-16-regular" style="color: #f96302;" data-width="35" data-height="35"></span>
                          <span class="mx-2"></span>
                          <span data-location="${json_obj[i].fields.location}" class="iconify" data-icon="mdi-light:map-marker" style="color: #f96302;" data-width="38" data-height="38"></span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div> 
              {% endif %}
              {% empty %}
              <p>no order now.</p>
              {% endfor %}
            </div>
          </div>
          
        </div><!-- /.container -->
      </div>
      <!-- /.content -->

{% endblock content %}

{% block js %}

<script>
setTimeout(function(){
   window.location.reload(1);
}, 10000);

// for accept
$(document).ready(function(){
  $(".btn-accept").each(function(){
    $(this).click(function(){
      var order_id = $(this).attr('data-id');
      $.ajax({
        url:'{% url "dashboard:accept_order" %}',
        method: 'get',
        data:{id:order_id, st: "accepted"},
        success: function(res){
          // alert(res);
          $(this).parents('.new_order_card').fadeOut();
        }, //endof success
      });//end of ajax
    });
  });
});

$(document).ready(function(){
  $(".btn-reject").each(function(){
    $(this).click(function(){
      var order_id = $(this).attr('data-id');
      
      $.ajax({
        url:'{% url "dashboard:accept_order" %}',
        method: 'get',
        data:{id:order_id, st:"rejected"},
        success: function(res){
          // alert(res);
          // $(this).hide('slow');
        }, //endof success
      });//end of ajax
    });
  });
});


</script>
{% endblock js %}