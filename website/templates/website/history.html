{% extends 'website/base.html' %}
{% load static %}
{% block css %}

{% endblock css %}
{% block content %}


<div class="container">
  <div class="row">
    <div class="col -sm-12 col md-3"></div>
    <div class="col-sm-12 col-md-6">
      {% for object in object_list %}
      <div class="card my-3 rounded-0 " style="border-color: #FF5400; ">
        <div class="card-body">
          <h5 class="card-title">{{object.date|date:"D d M Y"}}</h5>
          <p class="my-0 card-text">{{object.address}}</p>
          <hr class="my-0">
          
          {% for i in object.order_item_list.all %}
          <p class="my-2 ">
            <span class="rounded-0 py-1 px-2 my-auto mx-1" style="border: 1px solid #FF5400;">{{i.quantity}}</span>
            x 
            <b class="px-2">{{i.menu_item}}</b>
            <span class="active" style="float: right;">{{i.menu_item.price}} <span class="text-dark">AED</span> </span> 
            </p>
          {% endfor %}
          <hr class="my-0">
          <div class="row mt-2">
            <div class="col text-center"> <p class="my-0"><b> ORDER ID:</b> {{object.pk}}</p></div>
            <div class="col text-center">
              {% if object.payment_method == 'online' %}
              <P class="my-0"><b>Paid:</b> {{object.payment|default:""}}</P>
              {% else %}
              <P class="my-0"><b>Amount:</b> {{object.get_totol}}</P>
              {% endif %}
            </div>
            <div class="col text-center">
              <P class="my-0"><b>Via:</b> {{object.payment_method}}</P>              
            </div>
          </div>
          <div class="row mt-3">
            <div class="col col-sm-4"></div>
            <div class="col col-sm-4 text-center">
              <a class="btn mx-auto btn-orange rounded-0 re-order" data-id="{{object.pk}}"><b>RE-ORDER</b></a>
            </div>
            <div class="col col-sm-4"></div>
          </div>
         


          <!-- <a href="#" class="btn btn-primary">Go somewhere</a> -->
        </div>
      </div>
      {% endfor %}
    </div>
    <div class="col -sm-12 col md-3"></div>

  </div>
  
</div>

<div class="container">
  <div class="row pt-2">
    <div class="col d-flex justify-content-center ">
      {% if is_paginated %}

        {% if page_obj.has_previous %}
          <a class="btn btn-outline-dark rounded-0 mb-4 mx-1" href="?page=1">First</a  >
          <a class="btn btn-outline-dark rounded-0 mb-4 mx-1" href="?page={{ page_obj.previous_page_number }}">Back</a>
        {% endif %}

        {% for num in page_obj.paginator.page_range %}
          {% if page_obj.number == num %}
            <a class="btn btn-outline-dark rounded-0 mb-4 mx-1" href="?page={{num}}">{{num}}</a>
          {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
            <a class="btn btn-outline-dark rounded-0 mb-4 mx-1" href="?page={{num}}">{{num}}</a>
          {% endif %}
        {% endfor %}

        {% if page_obj.has_next %}
          <a class="btn btn-outline-dark rounded-0 mb-4 mx-1" href="?page={{page_obj.next_page_number }}">Next</a>
          <a class="btn btn-outline-dark rounded-0 mb-4 mx-1" href="?page={{page_obj.paginator.num_pages }}">Last</a>
        {% endif %}
      {% endif %}
    </div>
  </div>
</div>


</div>

{% endblock content %}


{% block js %}

<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
  $(document).ready(function(){
    $('.re-order').each(function(){
      $(this).click(function(){
        let pk = $(this).attr('data-id');
        $.ajax({
          url: '{% url "website:re_order" %}',
          method: 'get',
          data:{pk:pk},
          success: function(res){
            if(res == true){
              Swal.fire({
              icon: 'success',
              title: 'THANK YOU',
              text: 'Your order has been recieved.',
              showConfirmButton: false,
              timer: 2000
            })
          }else{
            Swal.fire({
            icon: 'error',
            title: 'please try again',
            showConfirmButton: false,
            timer: 1500
          })
          }
          }
        })
      }) //click
    }) //re-order
  })
</script>

{% endblock js %}

