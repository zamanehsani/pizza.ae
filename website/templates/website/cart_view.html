{% extends 'website/base.html' %}
{% load static %}

{% block css %}
<style>
  
  .md-stepper-horizontal {
    display:table;
    width:100%;
    margin:0 auto;
    /* background-color:#FFFFFF; */
    /* box-shadow: 0 3px 8px -6px rgba(0,0,0,.50); */
  }
  .md-stepper-horizontal .md-step {
    display:table-cell;
    position:relative;
    /* this is padding of each stepp */
    /* padding:24px; */
  }
  .md-stepper-horizontal .md-step:hover,
  .md-stepper-horizontal .md-step:active {
    /* uncoment this if you want hover eeffect*/
    /* background-color:rgba(0,0,0,0.04); */
  }
  .md-stepper-horizontal .md-step:active {
    border-radius: 15% / 75%;
  }
  .md-stepper-horizontal .md-step:first-child:active {
    border-top-left-radius: 0;
    border-bottom-left-radius: 0;
  }
  .md-stepper-horizontal .md-step:last-child:active {
    border-top-right-radius: 0;
    border-bottom-right-radius: 0;
  }
  .md-stepper-horizontal .md-step:hover .md-step-circle {
    background-color:#757575;
  }
  .md-stepper-horizontal .md-step:first-child .md-step-bar-left,
  .md-stepper-horizontal .md-step:last-child .md-step-bar-right {
    display:none;
  }
  .md-stepper-horizontal .md-step .md-step-circle {
    width:30px;
    height:30px;
    margin:0 auto;
    background-color:#999999;
    border-radius: 50%;
    text-align: center;
    line-height:30px;
    font-size: 16px;
    font-weight: 600;
    color:#FFFFFF;
  }
  .md-stepper-horizontal.green .md-step.active .md-step-circle {
    background-color:#198754;
  }
  .md-stepper-horizontal.orange .md-step.active .md-step-circle {
    background-color:#F96302;
  }
  .md-stepper-horizontal .md-step.active .md-step-circle {
    background-color: rgb(33,150,243);
  }
  .md-stepper-horizontal .md-step.done .md-step-circle:before {
    font-family:'FontAwesome';
    font-weight:100;
    content: "\f00c";
  }
  .md-stepper-horizontal .md-step.done .md-step-circle *,
  .md-stepper-horizontal .md-step.editable .md-step-circle * {
    display:none;
  }
  .md-stepper-horizontal .md-step.editable .md-step-circle {
    -moz-transform: scaleX(-1);
    -o-transform: scaleX(-1);
    -webkit-transform: scaleX(-1);
    transform: scaleX(-1);
  }
  .md-stepper-horizontal .md-step.editable .md-step-circle:before {
    font-family:'FontAwesome';
    font-weight:100;
    content: "\f040";
  }
  .md-stepper-horizontal .md-step .md-step-title {
    /* this is for the title of each step to be cloes to the circle */
    margin-top:5px;
    font-size:16px;
    font-weight:600;
  }
  .md-stepper-horizontal .md-step .md-step-title,
  .md-stepper-horizontal .md-step .md-step-optional {
    text-align: center;
    color:rgba(0,0,0,.26);
  }
  .md-stepper-horizontal .md-step.active .md-step-title {
    font-weight: 600;
    color:rgba(0,0,0,.87);
  }
  .md-stepper-horizontal .md-step.active.done .md-step-title,
  .md-stepper-horizontal .md-step.active.editable .md-step-title {
    font-weight:600;
  }
  .md-stepper-horizontal .md-step .md-step-optional {
    font-size:12px;
  }
  .md-stepper-horizontal .md-step.active .md-step-optional {
    color:rgba(0,0,0,.54);
  }
  .md-stepper-horizontal .md-step .md-step-bar-left,
  .md-stepper-horizontal .md-step .md-step-bar-right {
    position:absolute;
    /* this is the space of the line */
    top:15px;
    height:1px;
    border-top:1px solid #DDDDDD;
  }
  .md-stepper-horizontal .md-step .md-step-bar-right {
    right:0;
    left:50%;
    margin-left:20px;
  }
  .md-stepper-horizontal .md-step .md-step-bar-left {
    left:0;
    right:50%;
    margin-right:20px;
  }

  .table td , th {
   text-align: center;   
}


.counter {
    width: 150px;
    margin: auto;
    display: flex;
    align-items: center;
    justify-content: center;
    
}
.counter input {
    width: 50px;
    border: 0;
    display: block;
    line-height: 30px;
    font-size: 25px;
    text-align: center;
    background: #F96302;
    color: #fff;
    appearance: none;
    outline: 0;
    border-radius: 0px;
}
.counter .down {
    display: block;
    display: block;
    line-height: 30px;
    font-size: 25px;
    text-align: center;
    padding: 0 10px;
    cursor: pointer;
    color: #F96302;
    user-select: none;
    border-top-left-radius: 25px;
    border-bottom-left-radius: 25px ;
    border: 2px solid #F96302;
}

.counter .up {
    display: block;
    font-size: 25px;
    padding: 0 10px;
    line-height: 30px;
    cursor: pointer;
    color: #F96302;
    user-select: none;
    border-top-right-radius: 25px;
    border-bottom-right-radius:25px ;
    border: 2px solid #F96302;
}


</style>
{% endblock css %}


{% block content %}

{% include 'website/navbar.html' %}

<div class="container mt-4">
    <div class="row">
      <div class="card pt-2">
        <div class="md-stepper-horizontal green">
          <div class="md-step active done">
            <div class="md-step-circle"><span>1</span></div>
            <div class="md-step-title">your order</div>
            <div class="md-step-bar-left"></div>
            <div class="md-step-bar-right"></div>
          </div>
          <div class="md-step active done">
            <div class="md-step-circle"><span>2</span></div>
            <div class="md-step-title">your details</div>
            <div class="md-step-bar-left"></div>
            <div class="md-step-bar-right"></div>
          </div>
          <div class="md-step active">
            <div class="md-step-circle"><span>3</span></div>
            <div class="md-step-title">address</div>
            <div class="md-step-bar-left"></div>
            <div class="md-step-bar-right"></div>
          </div>
          <div class="md-step">
            <div class="md-step-circle"><span>4</span></div>
            <div class="md-step-title">payment</div>
            <div class="md-step-bar-left"></div>
            <div class="md-step-bar-right"></div>
          </div>
          <div class="md-step">
            <div class="md-step-circle"><span>4</span></div>
            <div class="md-step-title">confirm</div>
            <div class="md-step-bar-left"></div>
            <div class="md-step-bar-right"></div>
          </div>
        </div>
      </div>

    </div>

    <div class="row mt-3">
      <div class="card">
        <div class="table-responsive">
          <p class="fw-bold">your order details</p>
          <table class="table table-striped">
            <caption style="text-align: end; padding-right: 5%;" class="">Total: 200 AED</caption>
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">item</th>
                <th scope="col">Price</th>
                <th scope="col">Quantity</th>
                <th scope="col">Total price</th>
              </tr>
            </thead>
            <tbody id="order-table-body"> 

            </tbody>
          </table>
        </div>  
        <!-- end of table -->

        <div class="row" style="background-color: seashell;">
          <div class="col-sm-12 col-md-6">
            <div id="map" style="height:300px; width:auto"></div>
          </div>
          <div class="col-sm-12 col-md-6 pt-3 mb-3">
            <form>
              <div class="form-row">
                <div class="row">
                  <div class="form-group col-md-6">
                    <label for="name">Name</label>
                    <input type="text" class="form-control" id="name" placeholder="name">
                  </div>
                  <div class="form-group col-md-6">
                    <label for="number">Number</label>
                    <input type="tel" class="form-control" id="number" placeholder="phone number">
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label for="inputAddress">Address</label>
                <input type="text" class="form-control" id="inputAddress" placeholder="1234 Main St">
              </div>
              <div class="form-group">
                <label for="inputAddress2">Address 2</label>
                <input type="text" class="form-control" id="inputAddress2" placeholder="Apartment, studio, or floor">
              </div>
              <!-- <div class="form-row">
                <div class="form-group col-md-6">
                  <label for="inputCity">City</label>
                  <input type="text" class="form-control" id="inputCity">
                </div>
                <div class="form-group col-md-4">
                  <label for="inputState">State</label>
                  <select id="inputState" class="form-control">
                    <option selected>Choose...</option>
                    <option>...</option>
                  </select>
                </div>
                <div class="form-group col-md-2">
                  <label for="inputZip">Zip</label>
                  <input type="text" class="form-control" id="inputZip">
                </div>
              </div> -->
              <div class="form-group">
                <!-- <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="gridCheck">
                  <label class="form-check-label" for="gridCheck">
                    Check me out
                  </label>
                </div> -->
              </div>
              <!-- <button type="submit" class="btn btn-primary">Sign in</button> -->
            </form>
          </div>
        </div>

        <div class="row pt-4" style="background-color: palegoldenrod;">
          <div class="col-sm-12 col-md-6">
            <div class="form-group">
              <label>Optional</label>
              <textarea class="form-control" placeholder="add any note to your order here ..." rows="3"></textarea>
            </div>
          </div>
          <div class="col-sm-12 col-md-6 mb-3 mt-3 ">
            <p class="">total payment: 120 AED</p>
            <hr>
            <p>total payable: 120 AED</p>

            <button class="btn btn-outline-success rounded-pill d-block mx-auto px-5 py-3">Confirm and Preceed</button>
          </div>
        </div>
      </div>
    </div>

</div>

{% endblock content %}


{% block js %}
<link href="https://api.mapbox.com/mapbox-gl-js/v2.4.1/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v2.4.1/mapbox-gl.js"></script>

<script>

// load the orders into table
$(document).ready(function(){

  // check if their is an order key in localstorage
  if(localStorage.getItem("order")){
    
    // split the orders string to array by ;
    let order_arr = localStorage.getItem("order").split(";");
    var total_of_total = 0;
    for(let x in order_arr){
      let ord = JSON.parse(order_arr[x]);
      var html = `
      <tr>
        <th class="align-middle" scope="row">
          <span class="iconify" data-icon="mdi-light:delete" style="color: #f96302;" data-width="30" data-height="30"></span>
        </th>
        <td class="align-middle td-name">${ord.name}</td>
        <td class="align-middle td-price">${ord.price}</td>
        <td class="align-middle td-quantity">
          <div class="counter td-counter">
            <span class="down" onClick='decreaseCount(event, this)'>-</span>
            <input type="text" value="${ord.quantity}">
            <span class="up"  onClick='increaseCount(event, this)'>+</span>
          </div>
        </td>
        <td class="align-middle td-total-price">${parseFloat(ord.quantity) * parseFloat(ord.price) } AED</td>
      </tr>
      `;

      $("#order-table-body").append(html);
      total_of_total +=parseFloat(ord.id) * parseFloat(ord.price);
    }

    $("table caption").text("Total:" + total_of_total + " AED" );

  }else{
    // make the table empty
    console.log("your order is empty");
  }

});




	mapboxgl.accessToken = 'pk.eyJ1IjoiemFtYW5laHNhbmkiLCJhIjoiY2tzMngweHBoMDR6bDJwbGxwemdtcWdlYyJ9.In0ho8b2jje9pF86SKSUVA';
 
const map = new mapboxgl.Map({
      container: 'map', // container ID
      // style: 'mapbox://styles/mapbox/satellite-v9', 
      style:"mapbox://styles/mapbox/streets-v11",
      center: [55.2023781,25.1564378], // starting position [lng, lat]
      zoom: 12 
    });
 

  // Add geolocate control to the map.
  map.addControl(
    new mapboxgl.GeolocateControl({
      positionOptions: {
      enableHighAccuracy: true
      },
      // When active the map will receive updates to the device's location as it changes.
      trackUserLocation: true,
      // Draw an arrow next to the location dot to indicate which direction the device is heading.
      showUserHeading: true
    })
  );


  function increaseCount(a, b) {
        var input = b.previousElementSibling;
        var value = parseInt(input.value, 10); 
        value = isNaN(value)? 0 : value;
        value ++;
        input.value = value;
      }
      function decreaseCount(a, b) {
        var input = b.nextElementSibling;
        var value = parseInt(input.value, 10); 
        if (value > 1) {
          value = isNaN(value)? 0 : value;
          value --;
          input.value = value;
        }
      }


</script>


{% endblock js %}